<style>

/* Controls vertically centered */
.carousel-control-prev,
.carousel-control-next {
    top: 50%;
    transform: translateY(-50%);
    bottom: unset;
    height: auto;
    z-index: 20;
    position: absolute;
}

/* Hide carousel controls on mobile */
@media (max-width: 768px) {
    .carousel-control-prev,
    .carousel-control-next {
        display: none !important;
    }
}

/* Full-width wrapper */
.fullwidth-wrapper {
    width: 100vw;
    margin-left: calc(50% - 50vw);
}
</style>

{%- macro slide(image, title, subtitle, action, label, index, align="Left", theme="Dark") -%}

{%- set align_class = resolve_class({
    'text-right': align == 'Right',
    'text-center': align == 'Centre',
    'text-left': align == 'Left',
}) -%}

{%- set heading_class = 'text-white' if theme == 'Dark' else '' -%}



<div class="carousel-item {{ 'active' if index=='1' else '' }} hero-slide" >

    {% if action %}
        <a href="{{ action }}">
    {% endif %}

        <picture>
            <!-- Mobile image -->
            {% if values['slide_' + index + '_mobile_image'] %}
            <source
                media="(max-width: 768px)"
                srcset="{{ values['slide_' + index + '_mobile_image'] }}">
            {% endif %}

            <!-- Desktop fallback -->
            <img
                src="{{ image }}"
                alt="{{ title }}"
                loading="eager">
        </picture>

    {% if action %}
    </a>
    {% endif %}

    {% if title or subtitle %}
    <div class="carousel-body d-flex {{ align_class }}"
         style="width: 100%; padding: 0 2rem; position: absolute; top: 0; left: 0; height: 100%;">
        <div class="carousel-content align-self-center">

            {% if title %}
            <h1 class="{{ heading_class }}">{{ title }}</h1>
            {% endif %}

            {% if subtitle %}
            <p class="{{ heading_class }} mt-2">{{ subtitle }}</p>
            {% endif %}

            {% if action %}
            <a href="{{ action }}" class="btn btn-primary mt-3">{{ label }}</a>
            {% endif %}

        </div>
    </div>
    {% endif %}
</div>

{%- endmacro -%}


{%- set hero_slider_id = 'id-' + frappe.utils.generate_hash('HeroSlider', 12) -%}

<!-- Full-Width Wrapper -->
<div class="fullwidth-wrapper">

    <div id="{{ hero_slider_id }}" class="section-carousel carousel slide" data-ride="carousel">

        {% if show_indicators %}
        <ol class="carousel-indicators">
            {% for index in ['1','2','3','4','5'] %}
                {% if values['slide_' + index + '_image'] %}
                <li data-target="#{{ hero_slider_id }}"
                    data-slide-to="{{ frappe.utils.cint(index) - 1 }}"
                    class="{{ 'active' if index=='1' else '' }}">
                </li>
                {% endif %}
            {% endfor %}
        </ol>
        {% endif %}

        <div class="carousel-inner {{ resolve_class({'rounded-carousel': rounded }) }}">
            {% for index in ['1','2','3','4','5'] %}
                {% set image = values['slide_' + index + '_image'] %}
                {% if image %}
                    {{ slide(
                        image,
                        values['slide_' + index + '_title'],
                        values['slide_' + index + '_subtitle'],
                        values['slide_' + index + '_primary_action'],
                        values['slide_' + index + '_primary_action_label'],
                        index,
                        values['slide_' + index + '_content_align'],
                        values['slide_' + index + '_theme']
                    ) }}
                {% endif %}
            {% endfor %}
        </div>

        {% if show_controls %}
        <a class="carousel-control-prev" href="#{{ hero_slider_id }}" role="button" data-slide="prev">
            <div class="carousel-control">
                <svg class="mr-1" width="20" height="20" viewBox="0 0 18 18" fill="none">
                    <path d="M11.625 3.75L6.375 9L11.625 14.25"
                          stroke="#4C5A67" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
        </a>

        <a class="carousel-control-next" href="#{{ hero_slider_id }}" role="button" data-slide="next">
            <div class="carousel-control">
                <svg class="ml-1" width="20" height="20" viewBox="0 0 18 18" fill="none">
                    <path d="M6.375 14.25L11.625 9L6.375 3.75"
                          stroke="#4C5A67" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
        </a>
        {% endif %}

    </div>
</div>

<script>
frappe.ready(function () {
    $('.carousel').carousel({
        interval: 3000,
        pause: "hover",
        wrap: true
    });
});
</script>
