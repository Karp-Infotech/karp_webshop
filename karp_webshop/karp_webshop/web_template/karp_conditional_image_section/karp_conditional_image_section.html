

{# --- Begin: Section Embed Web Template --- #}

<!-- container must have an id so JS can show/hide it -->
<div class="embed-section-wrapper" data-condition_api="{{ condition_api or '' }}" style="display:none;">
  <div class="section-with-image {{ 'align-center' if align == 'Center' else '' }}">
	<h2 class="section-title">{{ _(title) }}</h2>
	{%- if subtitle -%}
	<p class="section-description">{{ _(subtitle) }}</p>
	{%- endif -%}

	{%- if image -%}
	{{ frappe.render_template('templates/includes/image_with_blur.html', {
		"src": image,
		"alt": image_description or title,
		"class": "section-image"
	}) }}
	{%- endif -%}
</div>

</div>

<script>
frappe.ready(function() {
  // Prefer class-based wrappers (recommended). Fallback to attribute selector if needed.
  let wrappers = Array.from(document.querySelectorAll('.embed-section-wrapper'));

  if (!wrappers.length) return;

  wrappers.forEach(function(wrapper) {
    // read API endpoint from data attribute (safe fallback to empty string)
    const api = (wrapper.dataset && (wrapper.dataset.conditionApi || wrapper.dataset.condition_api)) || '';

    // if no API specified, remove placeholder to avoid blank space
    if (!api) {
      wrapper.remove();
      return;
    }

    // call the api for this particular wrapper
    frappe.call({
      method: api,
      // optional: you can pass args if needed (e.g. campaign tokens)
      // args: { ... },

      callback: function(r) {
        try {
          if (r && r.message && r.message.show) {
            // show only this wrapper
            wrapper.style.display = '';
          } else {
            // remove this wrapper to avoid empty space
            if (wrapper && wrapper.parentNode) wrapper.parentNode.removeChild(wrapper);
          }
        } catch (e) {
          // on error remove this wrapper (safer)
          if (wrapper && wrapper.parentNode) wrapper.parentNode.removeChild(wrapper);
        }
      },

      error: function() {
        // on request error remove this wrapper
        if (wrapper && wrapper.parentNode) wrapper.parentNode.removeChild(wrapper);
      }
    });
  });
});
</script>
{# --- End: Section Embed Web Template --- #}
