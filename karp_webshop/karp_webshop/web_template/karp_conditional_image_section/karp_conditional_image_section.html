

{# --- Begin: Section Embed Web Template --- #}

<!-- container must have an id so JS can show/hide it -->
 <section class="section section-padding-bottom embed-section-wrapper-section" data-condition_api="{{ condition_api or '' }}"  data-section-idx="2" data-section-template="Karp Conditional Image Section">
  <div class="embed-section-wrapper">
  <div class="section-with-image {{ 'align-center' if align == 'Center' else '' }}">
	<h2 class="section-title">{{ _(title) }}</h2>
	{%- if subtitle -%}
	<p class="section-description">{{ _(subtitle) }}</p>
	{%- endif -%}

	{%- if image -%}
    <a href="{{ _(cta_url) }}">
     <picture>
      <!-- Mobile image -->
      {% if mobile_image %}
      <source
        media="(max-width: 768px)"
        srcset="{{ mobile_image }}">
      {% endif %}

      <!-- Desktop fallback -->
      <img
        src="{{ image }}"
        loading="eager">
    </picture>

  </a>
	{%- endif -%}
</div>

</div>

</section>


<script>
frappe.ready(function() {
  // Prefer class-based wrappers (recommended). Fallback to attribute selector if needed.
  let wrappers = Array.from(document.querySelectorAll('.embed-section-wrapper-section'));

  if (!wrappers.length) return;

  wrappers.forEach(function(wrapper) {
    // read API endpoint from data attribute (safe fallback to empty string)
    const api = (wrapper.dataset && (wrapper.dataset.conditionApi || wrapper.dataset.condition_api)) || '';

    // if no API specified, remove placeholder to avoid blank space
    if (!api) {
      wrapper.remove();
      return;
    }

    // call the api for this particular wrapper
    frappe.call({
      method: api,
      // optional: you can pass args if needed (e.g. campaign tokens)
      // args: { ... },

      callback: function(r) {
        try {
          if (r && r.message && r.message.show) {
            // show only this wrapper
            wrapper.style.display = '';
          } else {
            // remove this wrapper to avoid empty space
            if (wrapper && wrapper.parentNode) wrapper.parentNode.removeChild(wrapper);
          }
        } catch (e) {
          // on error remove this wrapper (safer)
          if (wrapper && wrapper.parentNode) wrapper.parentNode.removeChild(wrapper);
        }
      },

      error: function() {
        // on request error remove this wrapper
        if (wrapper && wrapper.parentNode) wrapper.parentNode.removeChild(wrapper);
      }
    });
  });
});
</script>
{# --- End: Section Embed Web Template --- #}
