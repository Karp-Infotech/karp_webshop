{% from "webshop/templates/includes/macros.html" import item_card, item_card_body %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>

<div class="section-with-cards item-card-group-section">
	<div class="item-group-header d-flex justify-content-between">
		<div class="title-section">
			{%- if title -%}
			<h2 class="section-title">{{ title }}</h2>
			{%- endif -%}
			{%- if subtitle -%}
			<p class="section-description">{{ subtitle }}</p>
			{%- endif -%}
		</div>
		<div class="primary-action-section">
			{%- if primary_action_url -%}
			<a href="{{ primary_action_url }}" class="btn btn-primary pull-right">
				{{ primary_action_label }} 
			</a>
			{%- endif -%}
		</div>
	</div>

	<div class="row">
        <div class="product-carousel owl-carousel">
            {%- for index in ['1', '2', '3', '4', '5', '6', '7', '8'] -%}
                {%- set item = values['wi_' + index] -%}
                {%- if item -%}
                    {%- set web_item = frappe.get_doc("Website Item", item) -%}
                    {% set single_discount = (web_item.custom_single_discount or 0) | float %}
                    {% set base_price = frappe.db.get_value("Item Price", {"item_code": web_item.item_code, "price_list": "Retail Selling", "selling": 1}, "price_list_rate") %}
                    {% set discounted_price = 0 %}
                    {%- if single_discount > 0 %}
                        {% set discounted_price = base_price * (1 - single_discount / 100) %}
                    {%- endif -%}
                    <div class="item">
                        <div class="product-card">
                            <a href="{{ web_item.route or '#' }}">
                                <img src="{{ web_item.website_image }}" alt="{{ web_item.web_item_name }}" class="img-fluid">
                            </a>
                            <h5 class="product-name">{{ web_item.web_item_name }}</h5>
                            {% if discounted_price > 0 %}
                            <p class="price">₹ {{ discounted_price }}
                                 <!-- Striked Price and Discount  -->
                                <small itemprop="highPrice" class="formatted-price">
                                    <s> ₹{{ base_price }}</s>
                                </small>
                            </p> 
                            {%- endif -%}                          
                             {% if discounted_price == 0 %}
                            <p class="price">₹ {{ base_price }}
                            </p> 
                            {%- endif -%}      
                        </div>
                    </div>

                 {%- endif -%}
            {%- endfor -%}
        </div>   
	</div>
</div>

<style>
    .product-carousel .item {
        padding: 15px;
        text-align: center;
    }

    .product-card {
        border: 1px solid #ddd;
        padding: 10px;
        border-radius: 10px;
        background: #fff;
    }

    .product-card img {
        max-width: 100%;
        height: auto;
    }

    @media (max-width: 768px) {
        .product-card {
            width: 100%;
        }
    }
</style>

<script>
    frappe.ready(function ()  {
  
        $(".product-carousel").owlCarousel({
            loop: true,
            margin: 10,
            nav: false,
            slideBy: 4,
            dots:true,
            autoplay:true,
            checkVisible:false,
            autoplayTimeout:3000,
            responsive: {
                0: {
                    items: 1  // 1 product on small screens
                },
                768: {
                    items: 2
                },
                1024: {
                    items: 4  // 4 products on large screens
                }
            }
        });
    });

</script>