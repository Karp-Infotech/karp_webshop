<script defer src="/assets/karp_webshop/js/product_ui/karp_grid.js"></script>

<script defer src="/assets/karp_webshop/js/karp_shopping_cart.js"></script>

<style>
.vsp-badge {
	display: inline-flex;
	align-items: center;
	gap: 4px;
	background-color: #e6f9ee; /* light green background */
	color: #0d6832; /* deep green text */
	border: 1px solid #a8e6b0;
	font-weight: 600;
	font-size: 0.8rem;
	padding: 2px 6px;
	border-radius: 6px;
	margin-top: 4px;
	display: flex;
    justify-content: center;
}

.vsp-icon {
	color: #0d6832;
	font-size: 0.9rem;
	line-height: 1;
}

.vsp-text {
	text-transform: uppercase;
	letter-spacing: 0.4px;
}
.try-on-btn {
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
    color: #ffffff;
    font-weight: 600;
    border-radius: 6px;
    padding: 6px 10px;
    border: none;
    text-align: center;
    display: block;
    width: 100%;
    margin-top: 8px;
    transition: 0.25s ease;
}
.try-on-btn:hover {
    background: linear-gradient(135deg, #1e40af, #1e3a8a);
    transform: translateY(-1px);
    box-shadow: 0 3px 12px rgba(30, 64, 175, 0.3);
}
</style>



{% from "webshop/templates/includes/macros.html" import attribute_filter_section, field_filter_section, discount_range_filters %}
{% extends "templates/web.html" %}

{% block title %}{{ title }}{% endblock %}
{% block header %}
<div class="mb-6">{{ title }}</div>
{% endblock header %}

{% block page_content %}
<input type="hidden" id="pc_field_filters" value='{{ field_filter | tojson | safe }}'>
<div class="row">


	<!-- Items section -->
	<div id="product-listing" class="col-12 order-2 col-md-9 order-md-2 item-card-group-section">
		<!-- Rendered via JS -->
	</div>

		<!-- Mobile Filter Button (visible on small screens only) -->
<div class="d-md-none mb-3">
  <button id="mobile-filter-btn" class="btn btn-outline-secondary" type="button" aria-label="Open filters">
    <svg style="width:18px;height:18px;vertical-align:middle;" aria-hidden="true"><use href="#icon-filter"></use></svg>
    <span style="margin-left:8px;">{{ _('Filters') }}</span>
  </button>
</div>

<!-- Mobile Off-canvas Drawer -->
<div id="mobile-filter-drawer" class="mobile-filter-drawer" aria-hidden="true" style="display:none;">
  <div class="mobile-filter-backdrop" role="button" tabindex="0" aria-label="Close filters"></div>
  <div class="mobile-filter-panel" role="dialog" aria-modal="true">
    <div class="mobile-filter-header d-flex justify-content-between align-items-center mb-3">
      <button id="mobile-filter-close" class="btn btn-sm btn-link" aria-label="Close filters">Close</button>
    </div>
    <div class="mobile-filter-body">
      <!-- cloned filters are injected here -->
    </div>
    <div class="mobile-filter-footer d-flex justify-content-between mt-3">
      <button id="mobile-filter-clear" class="btn btn-light">{{ _('Clear') }}</button>
      <button id="mobile-filter-apply" class="btn btn-primary">{{ _('Apply') }}</button>
    </div>
  </div>
</div>


	<!-- Filters Section -->
	<div class="col-12 order-1 col-md-3 order-md-1">
		<div class="collapse d-md-block mr-4 filters-section" id="product-filters">
			<div class="d-flex justify-content-between align-items-center mb-5 title-section">
				<div class="mb-4 filters-title" > {{ _('Filters') }} </div>
				<a class="mb-4 clear-filters" href='{{ frappe.request.url }}'>{{ _('Clear All') }}</a>
			</div>
			<!-- field filters -->
			{% if field_filters %}
				{{ field_filter_section(field_filters) }}
			{% endif %}

			<!-- attribute filters -->
			{% if attribute_filters %}
				{{ attribute_filter_section(attribute_filters) }}
			{% endif %}
		</div>

	</div>
</div>

<script>
	frappe.ready(() => {
		$('.btn-prev, .btn-next').click((e) => {
			const $btn = $(e.target);
			$btn.prop('disabled', true);
			const start = $btn.data('start');
			let query_params = frappe.utils.get_query_params();
			query_params.start = start;
			let path = window.location.pathname + '?' + frappe.utils.get_url_from_dict(query_params);
			window.location.href = path;
		});
	});
</script>

<script>
function openVtoInstructions(itemCode) {
    const url = `/vto-instructions?ic=${encodeURIComponent(itemCode)}`;

    // If you're using ERPNext Webshop modal
    frappe.web_form_dialog = new frappe.ui.Dialog({
        title: "Virtual Try-On",
        size: "large"
    });

    frappe.web_form_dialog.$body.html(`
        <iframe src="${url}"
                style="width:100%; height:80vh; border:0;">
        </iframe>
    `);

    frappe.web_form_dialog.show();
}
</script>


{% endblock %}


